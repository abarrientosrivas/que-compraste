<div *ngIf="compra" class="purchase-details container">
  <div class="header-section row align-items-center mb-4">
    <h1 class="store-name display-5">{{ compra.read_entity_name }}</h1>

    <div class="col-md-6">
      <p class="store-address text-muted">{{ compra.read_entity_address }}</p>
      <p class="store-address text-muted">{{ compra.read_entity_location }}</p>
      <p class="purchase-info text-muted">
        Fecha: {{ fechaFormateada }} | Hora: {{ horaFormateada }}
      </p>
      <button
        class="btn btn-primary mb-3"
        *ngIf="!isEditMode"
        (click)="editarCompra()"
      >
        Editar
      </button>
    </div>
    <div class="col-md-6 text-md-right">
      <h2 class="total-amount display-5 text-success">
        Total: {{ compra.total | currency : "USD" }}
      </h2>
      <p class="subtotal text-muted">
        Subtotal: {{ compra.subtotal | currency : "USD" }}
      </p>
      <p class="discount text-danger">
        Descuento: {{ compra.discount | currency : "USD" }}
      </p>
    </div>
  </div>

  <table class="table table-striped table-hover table-responsive-md">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Producto</th>
        <th scope="col">Precio Unitario</th>
        <th scope="col">Cantidad</th>
        <th scope="col">Total</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let item of compra.items; let i = index">
        <td *ngIf="!isEditMode">{{ item.read_product_text }}</td>
        <td *ngIf="isEditMode && item === selectedItem">
          <app-product-search
            (productSelected)="onProductSelected($event)"
          ></app-product-search>
        </td>
        <td *ngIf="isEditMode && item !== selectedItem">
          {{ item.read_product_text }}
        </td>

        <td *ngIf="!isEditMode">{{ item.value | currency : "USD" }}</td>
        <td *ngIf="isEditMode">
          <input
            type="number"
            [(ngModel)]="item.value"
            (ngModelChange)="onValueChange($event, i)"
          />
        </td>
        <td *ngIf="!isEditMode">{{ item.quantity }}</td>
        <td *ngIf="isEditMode">
          <input
            type="number"
            [(ngModel)]="item.quantity"
            (ngModelChange)="onQuantityChange($event, i)"
          />
        </td>
        <td *ngIf="!isEditMode">{{ item.total | currency : "USD" }}</td>
        <td *ngIf="isEditMode">{{ item.total | currency : "USD" }}</td>
        <button *ngIf="isEditMode" (click)="seleccionarItem(item)">
          Editar
        </button>
      </tr>
    </tbody>
  </table>

  <div class="d-flex justify-content-end" *ngIf="isEditMode">
    <button class="btn btn-success mr-2" (click)="guardarCambios()">
      Guardar
    </button>
    <button class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
  </div>
</div>
